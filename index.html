<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÙÙˆØ§Ø²ÙŠØ± Ø£Ù†Ø³ 3</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#070A12;
      --bg2:#0B1630;
      --card:#0E1B33cc;
      --stroke:#22385f;
      --text:#EAF0FF;
      --muted:#B8C4E6;
      --gold:#F7D47A;

      --green:#22c55e;
      --yellow:#facc15;
      --red:#ef4444;

      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Cairo", system-ui, -apple-system, "Segoe UI", Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(247,212,122,.22), transparent 60%),
        radial-gradient(900px 500px at 85% 30%, rgba(79,166,255,.20), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(10,18,40,.85), rgba(10,18,40,.55));
      border-bottom:1px solid rgba(34,56,95,.6);
    }
    .header-inner{
      max-width:980px;
      margin:0 auto;
      padding:16px 18px 14px;
      text-align:center;
    }
    .title{
      margin:0;
      font-size:28px;
      font-weight:800;
      letter-spacing:.2px;
      color:var(--gold);
      text-shadow: 0 8px 30px rgba(247,212,122,.20);
    }
    .subtitle{
      margin:6px 0 0;
      font-size:13px;
      color:var(--muted);
      opacity:.95;
    }

    .wrap{ max-width:980px; margin:0 auto; padding:18px; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:14px; }

    .card{
      background: var(--card);
      border:1px solid rgba(34,56,95,.75);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
      font-weight:800;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    input, textarea, select{
      background: rgba(8,16,34,.85);
      color:var(--text);
      border:1px solid rgba(34,56,95,.9);
      border-radius: 14px;
      padding:11px 12px;
      outline:none;
      font-family:inherit;
      font-size:15px;
    }
    input::placeholder, textarea::placeholder{ color: rgba(184,196,230,.75); }
    select{ min-width: 210px; }

    button{
      border:0;
      border-radius: 14px;
      padding:11px 12px;
      font-family:inherit;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      transition: transform .06s ease, filter .12s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px); }

    .btn-primary{
      background: linear-gradient(180deg, #2e8fff, #1b6ee9);
      color:white;
    }
    .btn-soft{
      background: rgba(55,65,81,.55);
      color:var(--text);
      border:1px solid rgba(34,56,95,.75);
    }
    .btn-danger{
      background: linear-gradient(180deg, #ff6b6b, #e53e3e);
      color:white;
    }
    .btn-gold{
      background: linear-gradient(180deg, #ffd98a, #e9b84f);
      color:#1b1b1b;
    }

    .hint{ margin-top:8px; color:var(--muted); font-size:13px; }

    /* âœ… Players container: horizontal cards that wrap nicely */
    .players{
      display:flex;
      flex-wrap:wrap;           /* Ø§Ù„Ù…Ù‡Ù…: ÙŠÙ†Ø²Ù„ ØµÙ Ø«Ø§Ù†ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
      gap:12px;
      margin-top:12px;
      align-items:stretch;
    }

    /* âœ… Smaller player card */
    .player{
      flex: 1 1 260px;          /* ÙƒØ±Øª Ù…ØªÙˆØ³Ø·â€”ÙŠÙ…Ø³Ùƒ ØµÙØŒ ÙˆÙŠÙ†Ø²Ù„ Ù„Ùˆ Ø¶Ø§Ù‚ */
      max-width: 420px;
      min-width: 240px;
      background: rgba(8,16,34,.70);
      border:1px solid rgba(34,56,95,.65);
      border-radius: 18px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .pheader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    /* âœ… name + points together */
    .pname{
      font-weight:900;
      font-size:16px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .pname span{
      color: var(--gold);
      font-weight:900;
    }

    /* âœ… controls layout: delete far, +/- together */
    .pcontrols{
      display:flex;
      align-items:center;
      justify-content:space-between; /* ÙŠØ­Ø· Ø§Ù„Ø­Ø°Ù Ø¨Ø¹ÙŠØ¯ */
      gap:12px;
    }

    .pmath{
      display:flex;
      gap:10px;                 /* + Ùˆ - Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ */
      align-items:center;
    }

    /* âœ… equal sized +/- */
    .btn-mini{
      width:52px;
      height:44px;
      border-radius: 14px;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      font-weight:900;
      line-height:1;
    }

    .btn-plus{
      background: linear-gradient(180deg, rgba(34,197,94,1), rgba(16,185,129,1));
      color:#06210f;
    }

    .btn-minus{
      background: linear-gradient(180deg, rgba(250,204,21,1), rgba(245,158,11,1));
      color:#2a1a00;
    }

    .btn-del{
      background: linear-gradient(180deg, #ff6b6b, #e53e3e);
      color:white;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:900;
      min-width:84px;
      text-align:center;
    }

    /* Auto-grow textarea */
    textarea{
      width:100%;
      min-height: 140px;
      resize: none;
      overflow: hidden;
      line-height: 1.7;
    }

    @media (max-width: 520px){
      .title{ font-size:24px; }
      .player{ flex:1 1 100%; min-width: 0; max-width: none; }
      .btn-del{ min-width:74px; }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-inner">
      <h1 class="title">ÙÙˆØ§Ø²ÙŠØ± Ø£Ù†Ø³ 3</h1>
      <p class="subtitle"> Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø£ÙˆÙ„ : Ø£Ù…ÙŠ ğŸ‘‘ 
      <br>Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ : Ù‡ÙŠÙˆÙ† ğŸ‘‘</p>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">

      <div class="card">
        <h2>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h2>
        <div class="row">
          <select id="quizSelect"></select>
          <input id="quizName" placeholder="Ø§Ø³Ù… Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©" />
          <button id="createQuiz" class="btn-gold">Ø¥Ù†Ø´Ø§Ø¡</button>
          <button id="deleteQuiz" class="btn-danger">Ø­Ø°Ù</button>
        </div>
        <div class="hint"></div>
      </div>

      <div class="card">
        <h2>Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ù†Ù‚Ø§Ø·</h2>
        <div class="row">
          <input id="playerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚" />
          <button id="addPlayer" class="btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
          <button id="resetPoints" class="btn-soft">ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
        </div>

        <div id="players" class="players"></div>
      </div>

      <div class="card">
        <h2>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
        <div class="hint"></div>
        <textarea id="questions" placeholder=""></textarea>
      </div>

    </div>
  </div>

  <script>
    const LS_KEY = "ramadan_quiz_host_v3";

    const $ = (id) => document.getElementById(id);
    const quizSelect = $("quizSelect");
    const quizName = $("quizName");
    const createQuiz = $("createQuiz");
    const deleteQuiz = $("deleteQuiz");
    const playerName = $("playerName");
    const addPlayer = $("addPlayer");
    const resetPoints = $("resetPoints");
    const playersDiv = $("players");
    const questions = $("questions");

    const load = () => {
      try { return JSON.parse(localStorage.getItem(LS_KEY) || "") } catch { return null }
    };
    const save = (state) => localStorage.setItem(LS_KEY, JSON.stringify(state));

    const state = load() || { current: null, quizzes: {} };

    const escapeHtml = (s) => String(s).replace(/[&<>"]/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"
    }[c]));

    const currentQuiz = () => state.current ? state.quizzes[state.current] : null;

    function ensureOneQuizIfEmpty(){
      const ids = Object.keys(state.quizzes);
      if (!ids.length){
        const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now());
        state.quizzes[id] = { name: "Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© 1", players: [], questions: "" };
        state.current = id;
        save(state);
      }
    }

    function renderQuizSelect() {
      const ids = Object.keys(state.quizzes);
      quizSelect.innerHTML = "";
      ids.forEach(id => {
        const opt = document.createElement("option");
        opt.value = id;
        opt.textContent = state.quizzes[id].name;
        quizSelect.appendChild(opt);
      });
      if (!state.current && ids.length) state.current = ids[0];
      quizSelect.value = state.current || "";
    }

    function autoGrowTextarea(el){
      el.style.height = "auto";
      el.style.height = (el.scrollHeight + 2) + "px";
    }

    function renderQuestions() {
      const q = currentQuiz();
      if (!q) {
        questions.value = "";
        questions.disabled = true;
        autoGrowTextarea(questions);
        return;
      }
      questions.disabled = false;
      questions.value = q.questions || "";
      autoGrowTextarea(questions);
    }

    function renderPlayers() {
      const q = currentQuiz();
      playersDiv.innerHTML = "";

      if (!q) {
        const empty = document.createElement("div");
        empty.className = "hint";
        empty.textContent = "Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø©.";
        playersDiv.appendChild(empty);
        return;
      }

      if (!q.players.length){
        const empty = document.createElement("div");
        empty.className = "hint";
        empty.textContent = "Ø£Ø¶Ù Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø¹Ø´Ø§Ù† ØªØ¨Ø¯Ø£ Ø§Ù„Ù†Ù‚Ø§Ø·.";
        playersDiv.appendChild(empty);
        return;
      }

      q.players.forEach((p, idx) => {
        const card = document.createElement("div");
        card.className = "player";

        // header: name (points) together
        const header = document.createElement("div");
        header.className = "pheader";

        const name = document.createElement("div");
        name.className = "pname";
        name.innerHTML = `${escapeHtml(p.name)} <span>(${p.points})</span>`;

        header.appendChild(name);

        // controls
        const controls = document.createElement("div");
        controls.className = "pcontrols";

        const math = document.createElement("div");
        math.className = "pmath";

        const plus = document.createElement("button");
        plus.className = "btn-mini btn-plus";
        plus.textContent = "+";
        plus.onclick = () => {
          p.points += 1;
          save(state);
          renderPlayers();
        };

        const minus = document.createElement("button");
        minus.className = "btn-mini btn-minus";
        minus.textContent = "âˆ’";
        minus.onclick = () => {
          p.points = Math.max(0, p.points - 1);
          save(state);
          renderPlayers();
        };

        math.appendChild(plus);
        math.appendChild(minus);

        const del = document.createElement("button");
        del.className = "btn-del";
        del.textContent = "Ø­Ø°Ù";
        del.onclick = () => {
          if (!confirm(`Ø­Ø°Ù Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: ${p.name} ØŸ`)) return;
          q.players.splice(idx, 1);
          save(state);
          renderPlayers();
        };

        // keep delete away from +/- (space-between)
        controls.appendChild(math);
        controls.appendChild(del);

        card.appendChild(header);
        card.appendChild(controls);

        playersDiv.appendChild(card);
      });
    }

    function renderAll(){
      renderQuizSelect();
      renderPlayers();
      renderQuestions();
    }

    createQuiz.onclick = () => {
      const name = (quizName.value || "").trim();
      if (!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©");
      const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now());
      state.quizzes[id] = { name, players: [], questions: "" };
      state.current = id;
      quizName.value = "";
      save(state);
      renderAll();
    };

    deleteQuiz.onclick = () => {
      const q = currentQuiz();
      if (!q) return;
      if (!confirm(`ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù: ${q.name} ØŸ`)) return;
      delete state.quizzes[state.current];
      state.current = Object.keys(state.quizzes)[0] || null;
      save(state);
      ensureOneQuizIfEmpty();
      renderAll();
    };

    quizSelect.onchange = () => {
      state.current = quizSelect.value || null;
      save(state);
      renderAll();
    };

    addPlayer.onclick = () => {
      const q = currentQuiz();
      if (!q) return alert("Ø£Ù†Ø´Ø¦ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹");
      const name = (playerName.value || "").trim();
      if (!name) return;
      q.players.push({ name, points: 0 });
      playerName.value = "";
      save(state);
      renderPlayers();
    };

    resetPoints.onclick = () => {
      const q = currentQuiz();
      if (!q) return;
      if (!confirm("ØªØ£ÙƒÙŠØ¯ ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©ØŸ")) return;
      q.players.forEach(p => p.points = 0);
      save(state);
      renderPlayers();
    };

    questions.addEventListener("input", () => {
      const q = currentQuiz();
      if (!q) return;
      q.questions = questions.value;
      save(state);
      autoGrowTextarea(questions);
    });

    // init
    ensureOneQuizIfEmpty();
    renderAll();
  </script>
</body>
</html>
